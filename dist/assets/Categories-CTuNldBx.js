import{j as e}from"./vendor-query-Bcn4Fvtg.js";import{u as re,r as o}from"./vendor-react-DbHp_wuh.js";import{U as ae,x as B,j as u,p as I,e as le,Z as W,y as V,m as ne,W as ie,n as oe}from"./index-CDJVr2wI.js";import{B as b}from"./Button-CC2RlQoZ.js";import{M as de}from"./Modal-Cghr_C7K.js";import{c as S,e as X,p as ce}from"./api--gIgMF1d.js";import"./vendor-icons-BV48wJe3.js";const je=()=>{const D=re(),[Z,j]=o.useState(!1),[d,G]=o.useState([]),[k,H]=o.useState([]),[J,E]=o.useState(!0),[M,L]=o.useState(null),[p,A]=o.useState(!1),[P,R]=o.useState(null),[v,K]=o.useState(""),[l,g]=o.useState({name:"",slug:"",description:"",icon:"",imageUrl:"",parentId:null}),[C,F]=o.useState("url"),[me,z]=o.useState(null),m=o.useRef(null);o.useEffect(()=>{y(),$()},[]);const y=async()=>{try{E(!0);const t=await S.getAll();console.log("Categories fetched:",t),G(X(t)),L(null)}catch(t){L(t.response?.data?.message||"Failed to fetch categories"),console.error("Error fetching categories:",t)}finally{E(!1)}},$=async()=>{try{const t=await ce.getAll();console.log("Products fetched:",t),H(X(t))}catch(t){console.error("Error fetching products:",t)}},U=d.filter(t=>!t.parentId&&(t.name.toLowerCase().includes(v.toLowerCase())||t.slug.toLowerCase().includes(v.toLowerCase()))),Q=d.filter(t=>!t.parentId),Y=d.filter(t=>t.parentId),N={total:d.length,parents:Q.length,subcategories:Y.length,productsCount:k.length},ee=async t=>{if(t.preventDefault(),!l.name||!l.name.trim()){alert("Category name is required");return}if(!l.slug||!l.slug.trim()){alert("Category slug is required");return}try{const s={name:l.name.trim(),slug:l.slug.trim()};if(l.description&&l.description.trim()&&(s.description=l.description.trim()),l.icon&&l.icon.trim()&&(s.icon=l.icon.trim()),l.imageUrl&&l.imageUrl.trim()&&(s.imageUrl=l.imageUrl.trim()),l.parentId&&(s.parentId=l.parentId),console.log("Submitting category:",s),console.log("Edit mode:",p),console.log("Selected category ID:",P),p){const a=P;console.log("Updating category with ID:",a),await S.update(a,s),alert("Category updated successfully!")}else await S.create(s),alert("Category created successfully!");j(!1),w(),y()}catch(s){console.error("Failed to save category:",s),console.error("Error response:",s.response?.data);const a=s.response?.data?.errors;let i=s.response?.data?.message||`Failed to ${p?"update":"create"} category`;a&&Array.isArray(a)&&a.length>0&&(i+=`

Details:
`+a.map(n=>`â€¢ ${n.path}: ${n.message}`).join(`
`)),alert(i)}},T=async(t,s)=>{if(d.some(n=>{const r=n.parentId?._id||n.parentId?.id||n.parentId;return String(r)===String(t)})){alert(`Cannot delete "${s.name}" because it has subcategories.

Please delete all subcategories first.`);return}const i=`Are you sure you want to delete "${s.name}"?

âš ï¸ Warning: This will also affect any products in this category.`;if(window.confirm(i))try{await S.delete(t),alert("Category deleted successfully!"),y()}catch(n){console.error("Failed to delete category:",n);const r=n.response?.data?.message||"Failed to delete category";r.toLowerCase().includes("product")||r.toLowerCase().includes("depend")?alert(`Cannot delete category:

${r}

Please move or delete all products in this category first.`):alert(`Failed to delete category:

${r}`)}},h=t=>{const{name:s,value:a}=t.target;if(s==="name"){const i=a.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");g(n=>({...n,name:a,slug:i}))}else g(s==="parentId"?i=>({...i,[s]:a===""?null:a}):i=>({...i,[s]:a}))},w=()=>{g({name:"",slug:"",description:"",icon:"",imageUrl:"",parentId:null}),A(!1),R(null),z(null),F("url"),m.current&&(m.current.value="")},_=t=>{const s=t.target.files?.[0];if(s){if(!s.type.startsWith("image/")){alert("Please select a valid image file");return}if(s.size>5*1024*1024){alert("Image size must be less than 5MB");return}const a=new FileReader;a.onload=i=>{const n=i.target?.result;g(r=>({...r,imageUrl:n})),z(n)},a.readAsDataURL(s)}},te=t=>{t.preventDefault(),t.stopPropagation();const s=t.dataTransfer?.files?.[0];if(s&&s.type.startsWith("image/")&&m.current){const a=new DataTransfer;a.items.add(s),m.current.files=a.files,_({target:{files:a.files}})}},O=t=>{console.log("Editing category:",t);const s=t._id||t.id;console.log("Category ID for edit:",s),A(!0),R(s),g({name:t.name,slug:t.slug,description:t.description||"",icon:t.icon||"",parentId:t.parentId||null}),j(!0)},q=()=>{w(),j(!0)};return J?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary"}),e.jsx("p",{className:"mt-4 text-secondary-text",children:"Loading categories..."})]})}):M?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:M}),e.jsx(b,{onClick:y,children:"Retry"})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-primary-text",children:"Categories"}),e.jsx("p",{className:"text-sm text-secondary-text mt-1",children:"Manage your product categories and hierarchy"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(b,{variant:"outline",onClick:()=>{y(),$()},children:[e.jsx(ae,{className:"inline mr-2"})," Refresh"]}),e.jsxs(b,{onClick:q,children:[e.jsx(B,{className:"inline mr-2"})," Add New Category"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white p-5 rounded-lg shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"Total Categories"}),e.jsx("h3",{className:"text-3xl font-bold mt-1",children:N.total})]}),e.jsx("div",{className:"bg-white bg-opacity-20 p-3 rounded-lg",children:e.jsx(u,{size:24})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white p-5 rounded-lg shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm font-medium",children:"Parent Categories"}),e.jsx("h3",{className:"text-3xl font-bold mt-1",children:N.parents})]}),e.jsx("div",{className:"bg-white bg-opacity-20 p-3 rounded-lg",children:e.jsx(u,{size:24})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-indigo-500 to-indigo-600 text-white p-5 rounded-lg shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-indigo-100 text-sm font-medium",children:"Subcategories"}),e.jsx("h3",{className:"text-3xl font-bold mt-1",children:N.subcategories})]}),e.jsx("div",{className:"bg-white bg-opacity-20 p-3 rounded-lg",children:e.jsx(I,{size:24})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white p-5 rounded-lg shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-sm font-medium",children:"Total Products"}),e.jsx("h3",{className:"text-3xl font-bold mt-1",children:N.productsCount})]}),e.jsx("div",{className:"bg-white bg-opacity-20 p-3 rounded-lg",children:e.jsx(u,{size:24})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-border p-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search categories by name or slug...",value:v,onChange:t=>K(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"})]}),v&&e.jsxs("p",{className:"text-sm text-secondary-text mt-2",children:["Showing ",e.jsx("span",{className:"font-semibold text-primary-text",children:U.length})," of ",e.jsx("span",{className:"font-semibold text-primary-text",children:N.parents})," parent categories"]})]}),U.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-border",children:[e.jsx("p",{className:"text-secondary-text mb-4",children:d.length===0?"No categories found":"No categories match your search"}),d.length===0&&e.jsxs(b,{onClick:q,children:[e.jsx(B,{className:"inline mr-2"})," Create First Category"]})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:U.map(t=>{const s=t._id||t.id,a=d.filter(r=>{const c=r.parentId?._id||r.parentId?.id||r.parentId;return String(c)===String(s)}),i=a.length>0,n=k.filter(r=>{const c=r.categoryId?._id||r.categoryId?.id||r.categoryId;return String(c)===String(s)});return e.jsxs("div",{className:"bg-gradient-to-br from-white to-gray-50 rounded-xl shadow-md border-2 border-blue-100 p-6 hover:shadow-xl hover:border-blue-300 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-5",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[t.icon&&e.jsx("div",{className:"bg-blue-100 p-3 rounded-xl",children:e.jsx("span",{className:"text-5xl",children:t.icon})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:t.name}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Parent"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Slug:"})," ",t.slug]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-2 italic",children:t.description}),e.jsxs("div",{className:"flex gap-3 mt-2",children:[i&&e.jsxs("span",{className:"inline-flex items-center text-xs font-semibold text-purple-700",children:[e.jsx(I,{className:"mr-1",size:14}),a.length," Subcategor",a.length===1?"y":"ies"]}),n.length>0&&e.jsxs("span",{className:"inline-flex items-center text-xs font-semibold text-green-700",children:[e.jsx(u,{className:"mr-1",size:14}),n.length," Product",n.length===1?"":"s"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>O(t),className:"p-2.5 hover:bg-blue-100 rounded-lg transition-colors",title:"Edit category",children:e.jsx(W,{size:20,className:"text-blue-600"})}),e.jsx("button",{onClick:()=>T(s,t),className:`p-2.5 rounded-lg transition-colors ${i?"bg-gray-100 cursor-not-allowed":"hover:bg-red-100"}`,title:i?"Cannot delete - has subcategories":"Delete category",disabled:i,children:e.jsx(V,{size:20,className:i?"text-gray-400":"text-red-600"})})]})]}),i&&e.jsxs("div",{className:"mt-5 pt-5 border-t-2 border-purple-100",children:[e.jsxs("h4",{className:"text-sm font-bold text-purple-900 mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"bg-purple-100 p-1.5 rounded",children:e.jsx(I,{size:16,className:"text-purple-600"})}),"Subcategories (",a.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:a.map(r=>{const c=r._id||r.id,f=k.filter(x=>{const se=x.categoryId?._id||x.categoryId?.id||x.categoryId;return String(se)===String(c)});return e.jsx("div",{className:"bg-white border-2 border-purple-100 rounded-lg p-4 hover:border-purple-300 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(I,{size:16,className:"text-purple-600"}),e.jsx("span",{className:"font-semibold text-gray-800",children:r.name})]}),e.jsxs("p",{className:"text-xs text-gray-500 ml-6",children:["Slug: ",r.slug]}),f.length>0&&e.jsxs("div",{className:"flex items-center gap-1 ml-6 mt-2",children:[e.jsx(u,{size:12,className:"text-green-600"}),e.jsxs("span",{className:"text-xs font-medium text-green-700",children:[f.length," product",f.length>1?"s":""]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>O(r),className:"p-1.5 hover:bg-blue-50 rounded transition-colors",title:"Edit subcategory",children:e.jsx(W,{size:14,className:"text-blue-600"})}),e.jsx("button",{onClick:()=>T(c,r),className:"p-1.5 hover:bg-red-50 rounded transition-colors",title:"Delete subcategory",children:e.jsx(V,{size:14,className:"text-red-600"})})]})]})},c)})})]}),n.length>0&&e.jsxs("div",{className:"mt-5 pt-5 border-t-2 border-green-100",children:[e.jsxs("h4",{className:"text-sm font-bold text-green-900 mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"bg-green-100 p-1.5 rounded",children:e.jsx(u,{size:16,className:"text-green-600"})}),"Products (",n.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:n.map(r=>{const c=r._id||r.id,f=r.prices?.find(x=>x.currency==="INR");return e.jsx("div",{className:"bg-white border-2 border-green-100 rounded-lg p-4 hover:border-green-300 hover:shadow-md transition-all cursor-pointer group",onClick:()=>D("/admin/products"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(u,{size:14,className:"text-green-600"}),e.jsx("span",{className:"font-semibold text-gray-800 text-sm group-hover:text-green-700 transition-colors",children:r.name})]}),f&&e.jsxs("p",{className:"text-sm font-bold text-green-700 ml-6",children:["â‚¹",f.amount.toLocaleString("en-IN")]}),r.supplier&&e.jsxs("p",{className:"text-xs text-gray-500 ml-6 mt-1",children:["by ",r.supplier?.companyName||"Unknown"]})]}),e.jsx("button",{onClick:x=>{x.stopPropagation(),D("/admin/products")},className:"p-1.5 hover:bg-green-100 rounded transition-colors opacity-0 group-hover:opacity-100",title:"View in Products",children:e.jsx(ne,{size:14,className:"text-green-600"})})]})},c)})})]})]},s)})}),e.jsx(de,{isOpen:Z,onClose:()=>{j(!1),w()},title:p?"Edit Category":"Add New Category",children:e.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-1",children:"Category Name *"}),e.jsx("input",{type:"text",name:"name",value:l.name,onChange:h,required:!0,className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter category name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-1",children:"Slug *"}),e.jsx("input",{type:"text",name:"slug",value:l.slug,onChange:h,required:!0,className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"category-slug"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Auto-generated from name, can be edited"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-1",children:"Icon (Emoji)"}),e.jsx("input",{type:"text",name:"icon",value:l.icon,onChange:h,className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"ðŸ­",maxLength:"10"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Optional: Add an emoji icon"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-2",children:"Category Image"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{type:"button",onClick:()=>F("url"),className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${C==="url"?"bg-primary text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"ðŸ“Ž Paste URL (Recommended)"}),e.jsx("button",{type:"button",onClick:()=>F("file"),className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${C==="file"?"bg-primary text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"ðŸ“¤ Upload File"})]}),C==="url"&&e.jsxs("div",{children:[e.jsx("input",{type:"url",name:"imageUrl",value:l.imageUrl,onChange:h,className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"https://example.com/image.jpg"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"âœ“ Recommended: Fast and reliable"})]}),C==="file"&&e.jsxs("div",{onDrop:te,onDragOver:t=>{t.preventDefault(),t.stopPropagation()},className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary hover:bg-blue-50 transition-colors cursor-pointer",onClick:()=>m.current?.click(),children:[e.jsx(ie,{size:24,className:"mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Drag and drop image here"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"or click to select (Max 5MB)"}),e.jsx("input",{ref:m,type:"file",accept:"image/*",onChange:_,className:"hidden"})]}),l.imageUrl&&e.jsxs("div",{className:"mt-3 relative",children:[e.jsx("div",{className:"p-2 border border-border rounded-lg bg-gray-50",children:e.jsx("img",{src:l.imageUrl,alt:"Category preview",className:"max-h-32 object-cover rounded mx-auto",onError:t=>{t.target.style.display="none"}})}),e.jsx("button",{type:"button",onClick:()=>{g(t=>({...t,imageUrl:""})),z(null),m.current&&(m.current.value="")},className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full hover:bg-red-600 transition-colors",title:"Remove image",children:e.jsx(oe,{size:14})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-1",children:"Description"}),e.jsx("textarea",{name:"description",value:l.description,onChange:h,className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",rows:"3",placeholder:"Category description..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-1",children:"Parent Category"}),e.jsxs("select",{name:"parentId",value:l.parentId||"",onChange:h,className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"None (Top Level Category)"}),d.filter(t=>{const s=t._id||t.id;return!t.parentId&&(!p||s!==P)}).map(t=>{const s=t._id||t.id;return e.jsx("option",{value:s,children:t.name},s)})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Optional: Make this a subcategory"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-border",children:[e.jsx(b,{variant:"outline",type:"button",onClick:()=>{j(!1),w()},children:"Cancel"}),e.jsx(b,{type:"submit",children:p?"Update Category":"Save Category"})]})]})})]})};export{je as default};
