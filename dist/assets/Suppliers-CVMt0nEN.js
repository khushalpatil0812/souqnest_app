import{j as e}from"./vendor-query-Bcn4Fvtg.js";import{r as l}from"./vendor-react-DbHp_wuh.js";import{_ as se,W as $,D as X,n as te,G as re,U as ae,x as Z,e as le,H as ie,Z as ne,y as oe}from"./index-CDJVr2wI.js";import{T as de,B as D}from"./Badge-BGqaB6wT.js";import{B as x}from"./Button-CC2RlQoZ.js";import{M as q}from"./Modal-Cghr_C7K.js";import{s as v,e as _,i as ce}from"./api--gIgMF1d.js";import"./vendor-icons-BV48wJe3.js";const ue=({isOpen:L,onClose:j,onSuccess:T})=>{const[c,w]=l.useState(null),[p,g]=l.useState(!1),[y,n]=l.useState(null),[C,h]=l.useState(null),N=l.useRef(null),U=5*1024*1024,O=[".xlsx",".csv"],S=()=>{w(null),n(null),h(null),N.current&&(N.current.value="")},A=()=>{S(),j()},E=o=>{if(!o)return"Please select a file";const a=o.name.substring(o.name.lastIndexOf(".")).toLowerCase();return O.includes(a)?o.size>U?"File size exceeds 5MB limit":null:"Invalid file type. Only .xlsx and .csv files are allowed"},P=o=>{const a=o.target.files[0];if(n(null),h(null),!a){w(null);return}const i=E(a);if(i){n(i),w(null),N.current&&(N.current.value="");return}w(a)},k=async()=>{if(!c){n("Please select a file");return}const o=E(c);if(o){n(o);return}g(!0),n(null),h(null);try{const a=new FormData;a.append("file",c);const i=await v.bulkUpload(a),u=i?.totalInserted||i?.data?.totalInserted||0;h(`Suppliers imported successfully! Total Inserted: ${u}`),S(),T&&setTimeout(()=>{T()},1500)}catch(a){if(console.error("Bulk upload error:",a),a.response){const i=a.response.status,u=a.response.data,r=u?.message||u?.error;if(i===400&&u?.details?.errors){const R=u.details.errors;let m=`❌ ${r}

`;m+=`Total Rows: ${u.details.totalRows}
`,m+=`Invalid Rows: ${u.details.invalidRows}

`,m+=`Errors:
`,R.forEach((M,I)=>{m+=`
Row ${M.row}:
`,M.errors.forEach(B=>{m+=`  • ${B}
`})}),n(m)}else switch(i){case 400:n(r||"Invalid file format or data validation failed");break;case 401:n("Unauthorized. Please login again");break;case 413:n("File too large. Maximum file size is 5MB");break;case 403:n("Access denied. Admin privileges required");break;default:n(r||"Failed to upload file. Please try again")}}else a.request?n("Network error. Please check your connection and ensure backend is running"):n("Failed to upload file. Please try again")}finally{g(!1)}},V=()=>{const o=`companyName,websiteUrl,supplierType,description,logoUrl,isFeatured,isAuthorizedPartner,isVerified
ABC Engineering,https://abc.com,MANUFACTURER,Industrial panels manufacturer,,TRUE,FALSE,TRUE
XYZ Traders,https://xyz.com,TRADER,Electronic components trader,,FALSE,TRUE,TRUE
Tech Services Ltd,https://techservices.com,SERVICE_PROVIDER,IT consulting services,,FALSE,FALSE,FALSE`,a=new Blob([o],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),u=URL.createObjectURL(a);i.setAttribute("href",u),i.setAttribute("download","supplier_bulk_upload_template.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(u)};return e.jsx(q,{isOpen:L,onClose:A,title:"Bulk Upload Suppliers",size:"md",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Upload Instructions:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Download the template and fill in supplier details"}),e.jsx("li",{children:"Only .xlsx and .csv files are accepted (use exact column names)"}),e.jsx("li",{children:"Maximum file size: 5MB"}),e.jsx("li",{children:"Maximum records: 100 per upload"}),e.jsxs("li",{children:[e.jsx("strong",{children:"Required:"})," companyName, supplierType"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Valid types:"})," MANUFACTURER, TRADER, CONTRACTOR, SERVICE_PROVIDER"]})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(x,{variant:"outline",onClick:V,children:[e.jsx(se,{className:"inline mr-2"})," Download Template"]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-2",children:"Select File"}),e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center",children:[e.jsx("input",{ref:N,type:"file",accept:".xlsx,.csv",onChange:P,className:"hidden",id:"file-upload",disabled:p}),e.jsxs("label",{htmlFor:"file-upload",className:`cursor-pointer ${p?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx($,{className:"mx-auto text-4xl text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:c?c.name:"Click to select or drag and drop"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:".xlsx or .csv (max 5MB)"})]})]})]}),c&&!y&&e.jsxs("div",{className:"flex items-center justify-between bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:c.name}),e.jsxs("span",{className:"text-xs text-green-600",children:["(",(c.size/1024).toFixed(2)," KB)"]})]}),e.jsx("button",{onClick:S,className:"text-green-600 hover:text-green-800",disabled:p,children:e.jsx(te,{size:18})})]}),y&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 max-h-64 overflow-y-auto",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(re,{className:"text-red-600 mt-0.5 flex-shrink-0"}),e.jsx("pre",{className:"text-xs text-red-800 whitespace-pre-wrap font-mono",children:y})]})}),C&&e.jsxs("div",{className:"flex items-start gap-2 bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx(X,{className:"text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-green-800",children:C})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(x,{onClick:k,disabled:!c||p,className:!c||p?"opacity-50 cursor-not-allowed":"",children:p?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-block animate-spin mr-2",children:"⏳"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"inline mr-2"})," Upload File"]})}),e.jsx(x,{variant:"outline",onClick:A,disabled:p,children:"Cancel"})]})]})})},ye=()=>{const[L,j]=l.useState(!1),[T,c]=l.useState(!1),[w,p]=l.useState(!1),[g,y]=l.useState(!1),[n,C]=l.useState(null),[h,N]=l.useState([]),[U,O]=l.useState([]),[S,A]=l.useState(!0),[E,P]=l.useState(null),[k,V]=l.useState(""),[o,a]=l.useState([]),[i,u]=l.useState(null),[r,R]=l.useState({companyName:"",websiteUrl:"",supplierType:"MANUFACTURER",description:"",logoUrl:"",contactEmail:"",contactPhone:"",isFeatured:!1,isAuthorizedPartner:!1,isVerified:!1});l.useEffect(()=>{m(),M()},[]);const m=async()=>{try{A(!0);const s=await v.getAll(),t=_(s),d=await Promise.all(t.map(async b=>{try{const F=await v.getIndustries(b.id);return{...b,industries:_(F)}}catch{return{...b,industries:[]}}}));N(d),P(null)}catch(s){P(s.response?.data?.message||"Failed to fetch suppliers"),console.error("Error fetching suppliers:",s)}finally{A(!1)}},M=async()=>{try{const s=await ce.getAll();O(_(s))}catch(s){console.error("Failed to load industries:",s)}},I=h.filter(s=>s.companyName.toLowerCase().includes(k.toLowerCase())||s.description&&s.description.toLowerCase().includes(k.toLowerCase())),B=async s=>{if(s.preventDefault(),!(r.isFeatured&&!g&&!window.confirm("⭐ Are you sure you want to mark this supplier as FEATURED?")))try{const t={companyName:r.companyName.trim(),supplierType:r.supplierType,isFeatured:r.isFeatured,isAuthorizedPartner:r.isAuthorizedPartner,isVerified:r.isVerified};r.websiteUrl?.trim()&&(t.websiteUrl=r.websiteUrl.trim()),r.description?.trim()&&(t.description=r.description.trim()),r.logoUrl?.trim()&&(t.logoUrl=r.logoUrl.trim()),r.contactEmail?.trim()&&(t.contactEmail=r.contactEmail.trim()),r.contactPhone?.trim()&&(t.contactPhone=r.contactPhone.trim()),g?(await v.update(n,t),alert("Supplier updated successfully!")):(await v.create(t),alert("Supplier created successfully!")),j(!1),z(),m()}catch(t){console.error("Supplier submission error:",t);const d=t.response?.data?.errors;let b=t.response?.data?.message||`Failed to ${g?"update":"create"} supplier`;d&&Array.isArray(d)&&d.length>0&&(b+=`:
`+d.map(F=>`- ${F.message||F}`).join(`
`)),alert(b)}},W=()=>{y(!1),C(null),z(),j(!0)},G=s=>{y(!0),C(s.id),R({companyName:s.companyName,websiteUrl:s.websiteUrl||"",supplierType:s.supplierType,description:s.description||"",logoUrl:s.logoUrl||"",contactEmail:s.contactEmail||"",contactPhone:s.contactPhone||"",isFeatured:s.isFeatured,isAuthorizedPartner:s.isAuthorizedPartner,isVerified:s.isVerified}),j(!0)},H=async s=>{if(window.confirm("Are you sure you want to delete this supplier?"))try{await v.delete(s),alert("Supplier deleted successfully!"),m()}catch(t){alert(t.response?.data?.message||"Failed to delete supplier")}},K=s=>{u(s),a(s.industries?.map(t=>t.industryId||t.id)||[]),p(!0)},Y=s=>{a(t=>t.includes(s)?t.filter(d=>d!==s):[...t,s])},J=async()=>{try{await v.updateIndustries(i.id,{industryIds:o}),alert("Industries updated successfully!"),p(!1),m()}catch(s){console.error("Failed to update industries:",s),alert(s.response?.data?.message||"Failed to update industries")}},z=()=>{R({companyName:"",websiteUrl:"",supplierType:"MANUFACTURER",description:"",logoUrl:"",contactEmail:"",contactPhone:"",isFeatured:!1,isAuthorizedPartner:!1,isVerified:!1}),y(!1),C(null)},f=s=>{const{name:t,value:d,type:b,checked:F}=s.target;R(ee=>({...ee,[t]:b==="checkbox"?F:d}))},Q=[{label:"Company Name",key:"companyName",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-primary-text",children:s.companyName}),s.contactEmail&&e.jsx("div",{className:"text-xs text-gray-500",children:s.contactEmail})]})},{label:"Website",key:"websiteUrl",render:s=>s.websiteUrl?e.jsx("a",{href:s.websiteUrl,target:"_blank",rel:"noreferrer",className:"text-primary-600 text-sm hover:underline truncate block max-w-[200px]",children:s.websiteUrl}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})},{label:"Type",key:"supplierType",render:s=>e.jsx(D,{variant:"default",children:s.supplierType?.replace("_"," ")})},{label:"Industries",key:"industries",render:s=>e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.industries&&s.industries.length>0?s.industries.slice(0,3).map((t,d)=>e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800",children:t.industry?.name||t.name||"Industry"},d)):e.jsx("span",{className:"text-gray-400 text-xs",children:"No industries"}),s.industries&&s.industries.length>3&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",s.industries.length-3," more"]})]})},{label:"Status",key:"status",render:s=>e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[s.isFeatured&&e.jsx(D,{variant:"featured",children:"Featured"}),s.isVerified&&e.jsx(D,{variant:"verified",children:"Verified"}),s.isAuthorizedPartner&&e.jsx(D,{variant:"primary",children:"Authorized"})]})},{label:"Actions",key:"actions",render:s=>e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>K(s),className:"p-2 hover:bg-indigo-50 rounded-lg transition-colors",title:"Manage Industries",children:e.jsx(ie,{size:16,className:"text-indigo-600"})}),e.jsx("button",{onClick:()=>G(s),className:"p-2 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit",children:e.jsx(ne,{size:16,className:"text-blue-600"})}),e.jsx("button",{onClick:()=>H(s.id),className:"p-2 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(oe,{size:16,className:"text-red-600"})})]})}];return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary"}),e.jsx("p",{className:"mt-4 text-secondary-text",children:"Loading suppliers..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-primary-text",children:"Supplier Management"}),e.jsx("p",{className:"text-sm text-secondary-text mt-1",children:"Manage suppliers and their industry associations"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(x,{variant:"outline",onClick:m,children:[e.jsx(ae,{className:"inline mr-2"})," Refresh"]}),e.jsxs(x,{variant:"outline",onClick:()=>c(!0),children:[e.jsx($,{className:"inline mr-2"})," Bulk Upload"]}),e.jsxs(x,{onClick:W,children:[e.jsx(Z,{className:"inline mr-2"})," Add New Supplier"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white p-5 rounded-lg shadow-md",children:[e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"Total Suppliers"}),e.jsx("h3",{className:"text-3xl font-bold mt-1",children:h.length})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white p-5 rounded-lg shadow-md",children:[e.jsx("p",{className:"text-green-100 text-sm font-medium",children:"Verified"}),e.jsx("h3",{className:"text-3xl font-bold mt-1",children:h.filter(s=>s.isVerified).length})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white p-5 rounded-lg shadow-md",children:[e.jsx("p",{className:"text-yellow-100 text-sm font-medium",children:"Featured"}),e.jsx("h3",{className:"text-3xl font-bold mt-1",children:h.filter(s=>s.isFeatured).length})]}),e.jsxs("div",{className:"bg-gradient-to-br from-indigo-500 to-indigo-600 text-white p-5 rounded-lg shadow-md",children:[e.jsx("p",{className:"text-indigo-100 text-sm font-medium",children:"Industries"}),e.jsx("h3",{className:"text-3xl font-bold mt-1",children:U.length})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-border p-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search suppliers by name or description...",value:k,onChange:s=>V(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"})]}),k&&e.jsxs("p",{className:"text-sm text-secondary-text mt-2",children:["Showing ",I.length," of ",h.length," suppliers"]})]}),E&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg",children:E}),!E&&I.length===0&&!S&&e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-border",children:[e.jsx("p",{className:"text-secondary-text mb-4",children:"No suppliers found"}),e.jsxs(x,{onClick:W,children:[e.jsx(Z,{className:"inline mr-2"})," Add First Supplier"]})]}),I.length>0&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-border overflow-hidden",children:e.jsx(de,{columns:Q,data:I})}),e.jsx(q,{isOpen:L,onClose:()=>{j(!1),z()},title:g?"Edit Supplier":"Add New Supplier",size:"lg",children:e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-1",children:"Company Name *"}),e.jsx("input",{type:"text",name:"companyName",value:r.companyName,onChange:f,required:!0,className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter company name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-1",children:"Website URL"}),e.jsx("input",{type:"url",name:"websiteUrl",value:r.websiteUrl,onChange:f,className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"https://www.example.com"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-1",children:"Supplier Type *"}),e.jsxs("select",{name:"supplierType",value:r.supplierType,onChange:f,required:!0,className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"MANUFACTURER",children:"Manufacturer"}),e.jsx("option",{value:"TRADER",children:"Trader"}),e.jsx("option",{value:"CONTRACTOR",children:"Contractor"}),e.jsx("option",{value:"SERVICE_PROVIDER",children:"Service Provider"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-1",children:"Logo URL"}),e.jsx("input",{type:"url",name:"logoUrl",value:r.logoUrl,onChange:f,className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"https://example.com/logo.png"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-1",children:"Contact Email"}),e.jsx("input",{type:"email",name:"contactEmail",value:r.contactEmail,onChange:f,className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"contact@company.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-1",children:"Contact Phone"}),e.jsx("input",{type:"tel",name:"contactPhone",value:r.contactPhone,onChange:f,className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"+91 9876543210"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-text mb-1",children:"Description"}),e.jsx("textarea",{name:"description",value:r.description,onChange:f,className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",rows:"4",placeholder:"Company description..."})]}),e.jsxs("div",{className:"flex gap-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",name:"isFeatured",checked:r.isFeatured,onChange:f,className:"rounded w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Featured Supplier"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",name:"isVerified",checked:r.isVerified,onChange:f,className:"rounded w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Verified"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",name:"isAuthorizedPartner",checked:r.isAuthorizedPartner,onChange:f,className:"rounded w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Authorized Partner"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(x,{type:"submit",children:g?"Update Supplier":"Create Supplier"}),e.jsx(x,{variant:"outline",type:"button",onClick:()=>{j(!1),z()},children:"Cancel"})]})]})}),e.jsx(q,{isOpen:w,onClose:()=>p(!1),title:`Manage Industries — ${i?.companyName||""}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-secondary-text",children:"Select the industries this supplier operates in:"}),e.jsx("div",{className:"max-h-80 overflow-y-auto space-y-2",children:U.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No industries available. Create industries first."}):U.map(s=>{const t=s.id||s._id,d=o.includes(t);return e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${d?"border-indigo-400 bg-indigo-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"checkbox",checked:d,onChange:()=>Y(t),className:"rounded w-4 h-4 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:s.name}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:s.description})]})]},t)})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[o.length," selected"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(x,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(x,{onClick:J,children:"Save Industries"})]})]})]})}),e.jsx(ue,{isOpen:T,onClose:()=>c(!1),onSuccess:()=>m()})]})};export{ye as default};
